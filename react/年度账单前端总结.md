### 1.前端技术栈
react + react-router3.0 + SASS + axios + webpack

### 2.前端页面设计以及实现详解

路由设计
```
<Route path='/annualBill/index' getComponent={annualBillHome} />
<Route path='/annualBill/bill' getComponent={annualBillPage} />
<Route path='/annualBill/billShare' getComponent={annualBillSharePage} />

<Route path='/annualBill/share' getComponent={annualBillShareHome} />
<Route path='/annualBill/login' getComponent={annualBillLogin} />
<Route path='/annualBill/old' getComponent={annualBillOldShare} />
<Route path='/annualBill/oldResult' getComponent={annualBillOldResult} />
<Route path='/annualBill/oldTip' getComponent={annualBillOldTip} />
<Route path='/annualBill/new' getComponent={annualBillNewShare} />
```
Tips：
H5活动时效性短，过期路由可以注销，防止拖慢打包速度。
但是，这样做会导致路由越来越臃肿(删除路由万一以后还想找回呢)。后续应该引入react-router-config做路由拆分
如按功能模块拆分。

#### 2.1.年度账单模块（app内）
```
--bill
------index.js
------bill.js
------billShare.js
```

index
首页入口，通过后台接口权限控制入口

bill
所有账单滑动展示页。单页面。通过 swiper.js 控制前后页滑动

billShare
账单分享页

总结：账单模块比较简单，没其他难点


#### 2.2 分享赚积分页面（微信等第三方APP webview内）
```
--share
------share.js
------login.js
------new.js
------old.js
------old-result.js
------old-tip.js
```
share.js

分享入口页。这个页面主要作用：
>1.缓存参数。比如mallNo（等同mallCode），APP分享出来的邀请码inviteCode

>2.跳转控制

>如果不存在token，跳转至登录页'/annualBill/login'

>如果存在token，如果是新用户（localStorage.getItem('isNewUser')=='1'，上次登录保存），跳转至新用户页面'/annualBill/new'

>如果存在token，如果是老用户,跳转至'/annualBill/old'

login.js

登录需要mallNo(等同mallCode)，所以需要先选场（顺序不可调换）

选场逻辑：
根据app分享的url获取mallNo，如果链接的商场编号在配置商场列表里（/mall/getmallsList获取）
显示默认商场名称，否则不显示。需要遍历,数据量不多就用最简单的循环查找：
```js
getMallNameFn(res){
    let mallCode = this.getParam('mallCode')||'';
    let list = res&&res.data|| this.state.mallList
    for(var i = 0,len = list.length; i<len; i++){
        if(list[i].mallCode == mallCode){
            return list[i].mallName
        }
    }
    return ''
}
```

old.js

老用户开福袋页面。

点击请求接口。如果成功，直接跳结果页old-result.js。不成功。根据状态跳至old-tip.js,分情况展示页面


### 3.本次开发设计的组件化业务
登录组件，商场选择组件，音乐组件。


#### 3.1登录组件LoginView:
处理登录相关，父组件需要传递必要的回调.
登录组件需要处理：输入校验，错误提示，短信验证，短信倒计时等
```js
parent page:

successLoginCallBack(){
    localStorage.setItem('token',res.data.token)
    localStorage.setItem('isNewUser',res.data.isNewUser) //是否新用户
    localStorage.removeItem('inviteCode')//删除原来用户的邀请码
}

----------------------
login page:

<LoginView successLoginCallBack={this.successLoginCallBack.bind(this)}></LoginView>

getQuickLogin({
    userName: userName,
    code: code,
    mallNo: mallNo,
    acceptAgreement: 1,
    inviteCode: inviteCode
},(res)=>{
    this.props.successLoginCallBack()
})
```

#### 3.2 商场选择组件 MixcFooterpickView:

```html
<MixcFooterpickView
    data={this.state.mallList}
    selectMallCode={this.state.mallCode}
    isShow={this.state.isShow}
    name={this.state.pickViewName}
    selectMallCodeFn={this.selectMallCodeFn.bind(this)}
    hideMixcMallSelect={this.hideMixcMallSelect.bind(this)}>
</MixcFooterpickView>
```

data为商场列表后台返回。（此处mallList需要进行策略缓存，不能每次打开都加载）

selectMallCode为选中商场

isShow控制弹出框显示与关闭

selectMallCodeFn，点击选中并触发回调

hideMixcMallSelect：关闭弹出框


#### 3.3 音乐组件
类似‘无状态’的封闭组件。不需要与父组件做通讯，实现比较简单。

动画实现方式：css3(animation和keyframes，旋转rotate，transform) 具体是添加动画类



### 4.遇到的难题以及解决方案
UI问题：
#### 4.1 全屏背景显示，适配，要求不遮盖页面关键背景元素
问题：
设计时，前端就发现设计稿无法适配大屏手机（宽度可以自适应到100%,当然超过750px会开始放大但会模糊,所以主要问题是高度适配）。
因为时间太赶，只能先完成功能。后续商量了几种微调方案比如：尾部加长；尾部关键区域切图（透明图）。都因改动太大或效果不好而放弃。

最终解决方式：采用背景图方式（原来是img标签加载），宽度100%，上下留底，背景取中间。
```css
background: url(/h5/new/build/static/media/bill_bg_01.jpg) no-repeat center center;
background-size: cover;
```

#### 4.2.图片高清问题
通过css媒体查询库或者javascript条件判断，在不同的dpr下加载不同尺寸的图片
```css
.css{/* 普通显示屏(设备像素比例小于等于1.3)使用1倍的图 */
    background-image: url(img_1x.png);
}
@media only screen and (-webkit-min-device-pixel-ratio:1.5){
.css{/* 高清显示屏(设备像素比例大于等于1.5)使用2倍图  */
    background-image: url(img_2x.png);
  }
}
```
```css
 image-set 设计retina背景图
.css{
    background: url(../img/bank_ico.png) no-repeat;/* 不支持image-set的显示屏 */
    background: -webkit-image-set(
                url(../img/bank_ico.png) 1x,/* 支持image-set的浏览器的[普通屏幕]下 */
                url(../img/bank_ico_retina.png) 2x);/* 支持image-set的浏览器的[Retina屏幕] */

}
```
#### 4.3 交互细节
按钮状态：点击，滑过，激活等状态

正确的顺序：LVHA

a:link、a:visited、a:hover、a:active

连接平常的状态 连接被访问过之后  鼠标放到连接上的时候  连接被按下的时候
```css
.restart-btn{
      margin-right: 0.48rem;
      background: url("../../img/annualBill/goToHeadBtn.png") no-repeat;
      background-size: cover;
      width:2.82rem;
      height: 0.76rem;
      &:link {
        background: url("../../img/annualBill/goToHeadBtn.png") no-repeat;
        background-size: cover;
      }
      &:visited {
        background: url("../../img/annualBill/goToHeadBtn.png") no-repeat;
        background-size: cover;
      }
      &:hover{
        background: url("../../img/annualBill/goToHeadBtn-active.png") no-repeat;
        background-size: cover;
      }
      &:active{
        background: url("../../img/annualBill/goToHeadBtn-active.png") no-repeat;
        background-size: cover;
      }
    }
 ```
#### 4.4.滚动流畅
```css
body{
    -webkit-overflow-scrolling:touch;
}
5.禁止用户选中文字
-webkit-user-select:none
 ```
#### 4.5 后台数据返回之前，前端初始值如何设置
问题描叙： 请求发出，前端未收到响应时。页面存在undefined或者null的情况。

解决方式： 前端设置默认值。（或者返回前页面隐藏，但是会存在白屏时间长问题，影响体验）


